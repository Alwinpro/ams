<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Legacy Camera Test</title>
    <style>
        body {
            background: black;
            color: white;
            font-family: sans-serif;
            text-align: center;
        }
        #console {
            text-align: left;
            background: #222;
            border: 1px solid #555;
            height: 150px;
            overflow: scroll;
            padding: 5px;
            font-size: 12px;
            margin-top: 20px;
        }
        video {
            width: 90%;
            border: 2px solid white;
            margin-top: 10px;
        }
        button {
            font-size: 20px;
            padding: 10px 20px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Legacy Mode</h1>
    <p>Android 4.4 Camera Test</p>
    <video id="vid" autoplay playsinline></video>
    <br>
    <button onclick="startCam()">Start Camera</button>
    <div id="console">Log:<br></div>
    <script>
        function log(msg) {
            var c = document.getElementById('console');
            c.innerHTML += msg + "<br>";
            c.scrollTop = c.scrollHeight;
        }
        window.onerror = function (msg, url, line) {
            log("ERROR: " + msg + " line " + line);
        };
        log("JS Engine Started.");
        function startCam() {
            log("Button Clicked. Asking permissions...");
            var video = document.getElementById('vid');
            var n = navigator;
            // 1. Try Standard
            if (n.mediaDevices && n.mediaDevices.getUserMedia) {
                log("Method A: mediaDevices");
                n.mediaDevices.getUserMedia({ video: true })
                    .then(function (stream) {
                        log("Stream Success (A)");
                        video.srcObject = stream;
                    })
                    .catch(function (e) { log("Err A: " + e.message); tryB(); });
            } else {
                tryB();
            }
            function tryB() {
                // 2. Try Webkit
                log("Method B: webkitGetUserMedia");
                if (n.webkitGetUserMedia) {
                    n.webkitGetUserMedia({ video: true }, function (stream) {
                        log("Stream Success (B)");
                        video.src = window.webkitURL.createObjectURL(stream);
                        video.play();
                    }, function (e) { log("Err B: " + e.name); });
                } else {
                    log("Method B failed or missing.");
                }
            }
        }
        // Auto start
        setTimeout(startCam, 1000);
    </script>
</body>
</html>
